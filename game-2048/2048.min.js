function $(a){return document.getElementById(a)}var game={data:[],RN:4,CN:4,score:0,top:0,state:1,RUNNING:1,GAMEOVER:0,init:function(){$("gridPanel").style.width=this.CN*116+16+"px";$("gridPanel").style.height=this.CN*116+16+"px";var d=[];var a=[];for(var b=0;b<this.RN;b++){for(var e=0;e<this.CN;e++){d.push('<div id="g'+b+e+'" class="grid"></div>');a.push('<div id="c'+b+e+'" class="cell"></div>')}}$("gridPanel").innerHTML=d.join("")+a.join("")},start:function(){var a=this;this.init();for(var b=0;b<a.RN;b++){a.data.push([]);for(var d=0;d<a.CN;d++){a.data[b][d]=0}}$("top").innerHTML=this.getTop();$("gameover").style.display="none";this.score=0;this.state=this.RUNNING;a.randomNum();a.randomNum();a.updateView();document.onkeydown=function(){if(this.state==this.RUNNING){var c=window.event||arguments[0];switch(c.keyCode){case 37:a.moveLeft();break;case 38:a.moveUp();break;case 39:a.moveRight();break;case 40:a.moveDown();break;case 13:a.start();break}}}},setTop:function(b){var a=new Date();a.setFullYear(a.getFullYear()+1);document.cookie="top="+b+";expires="+a.toGMTString()},getTop:function(){var a=parseInt(document.cookie.slice(4));return isNaN(a)?0:a},isGameOver:function(){for(var a=0;a<this.RN;a++){for(var b=0;b<this.CN;b++){if(this.data[a][b]==0){return false}else{if(b<this.CN-1&&this.data[a][b]==this.data[a][b+1]){return false}else{if(a<this.RN-1&&this.data[a][b]==this.data[a+1][b]){return false}}}}}return true},randomNum:function(){for(;;){var a=Math.floor(Math.random()*this.RN);var b=Math.floor(Math.random()*this.CN);if(this.data[a][b]==0){this.data[a][b]=Math.random()<=0.5?2:4;break}}},updateView:function(){for(var a=0;a<this.RN;a++){for(var e=0;e<this.CN;e++){var d="c"+a+e;var b=$(d);if(this.data[a][e]==0){b.innerHTML="";b.className="cell"}else{b.innerHTML=this.data[a][e];b.className="cell n"+this.data[a][e]}}}$("score").innerHTML=this.score;if(this.isGameOver()){this.state=this.GAMEOVER;$("gameover").style.display="block";$("finalScore").innerHTML=this.score;if(this.score>this.getTop()){this.setTop(this.score)}}},move:function(a){var b=this.data.toString();a.call(this);var c=this.data.toString();if(b!=c){this.randomNum();this.updateView()}},moveLeft:function(){this.move(function(){for(var a=0;a<this.RN;a++){this.moveLeftInRow(a)}})},moveLeftInRow:function(a){for(var d=0;d<this.CN-1;d++){var b=this.getRightInRow(a,d);if(b==-1){break}else{if(this.data[a][d]==0){this.data[a][d]=this.data[a][b];this.data[a][b]=0;d--}else{if(this.data[a][d]==this.data[a][b]){this.data[a][d]*=2;this.data[a][b]=0;this.score+=this.data[a][d]}}}}},getRightInRow:function(a,d){for(var b=d+1;b<this.CN;b++){if(this.data[a][b]!=0){return b}}return -1},moveRight:function(){this.move(function(){for(var a=0;a<this.RN;a++){this.moveRightInRow(a)}})},moveRightInRow:function(a){for(var d=this.CN-1;d>0;d--){var b=this.getLeftInRow(a,d);if(b==-1){break}else{if(this.data[a][d]==0){this.data[a][d]=this.data[a][b];this.data[a][b]=0;d++}else{if(this.data[a][d]==this.data[a][b]){this.data[a][d]*=2;this.data[a][b]=0;this.score+=this.data[a][d]}}}}},getLeftInRow:function(a,d){for(var b=d-1;b>=0;b--){if(this.data[a][b]!=0){return b}}return -1},moveUp:function(){this.move(function(){for(var a=0;a<this.CN;a++){this.moveUpInCol(a)}})},moveUpInCol:function(d){for(var b=0;b<this.RN-1;b++){var a=this.getBottomInCol(b,d);if(a==-1){break}else{if(this.data[b][d]==0){this.data[b][d]=this.data[a][d];this.data[a][d]=0;b--}else{if(this.data[b][d]==this.data[a][d]){this.data[b][d]*=2;this.data[a][d]=0;this.score+=this.data[b][d]}}}}},getBottomInCol:function(b,d){for(var a=b+1;a<this.RN;a++){if(this.data[a][d]!=0){return a}}return -1},moveDown:function(){this.move(function(){for(var a=0;a<this.CN;a++){this.moveDownInCol(a)}})},moveDownInCol:function(d){for(var b=this.RN-1;b>0;b--){var a=this.getTopInCol(b,d);if(a==-1){break}else{if(this.data[b][d]==0){this.data[b][d]=this.data[a][d];this.data[a][d]=0;b++}else{if(this.data[b][d]==this.data[a][d]){this.data[b][d]*=2;this.data[a][d]=0;this.score+=this.data[b][d]}}}}},getTopInCol:function(b,d){for(var a=b-1;a>=0;a--){if(this.data[a][d]!=0){return a}}return -1}};window.onload=function(){game.start()};